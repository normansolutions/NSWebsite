<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>Schoolbase to create and populate AD groups</title>
  <slug>using-schoolbase-to-create-and-populate-ad-groups</slug>
  <author></author>
  <pubDate>2014-01-22 11:52:12</pubDate>
  <lastModified>2014-01-22 11:52:12</lastModified>
  <content>&lt;p&gt;At &lt;a href="http://www.st-marys-shaftesbury.co.uk/" target="_blank"&gt;St Mary’s&lt;/a&gt; we use &lt;a href="http://www.furlongsolutions.com/products/schoolbase" target="_blank"&gt;Schoolbase&lt;/a&gt; from Furlong Solutions, for our &lt;a href="http://en.wikipedia.org/wiki/Management_information_systems" target="_blank"&gt;MIS&lt;/a&gt; - we have done so for several years &lt;em&gt;(indeed my understanding is that we were the second or third official school to have the system in production).&lt;/em&gt;&lt;/p&gt; &lt;p&gt;We have had, and continue to have, an excellent and honest relationship with Furlong.&amp;nbsp; From my experience, I cannot speak highly enough of their commitment, flexibility and moral approach to supporting schools.&amp;nbsp; Of the many MIS companies that I have been involved with in recent years &lt;em&gt;(one way or another),&lt;/em&gt; Furlong often exceed expectation, when faced with a desperate requirement for a quick solution turnaround &lt;em&gt;(very &lt;/em&gt;&lt;a href="http://en.wikipedia.org/wiki/Agile_software_development" target="_blank"&gt;&lt;em&gt;Agile&lt;/em&gt;&lt;/a&gt;&lt;em&gt; like).&lt;/em&gt;&lt;/p&gt; &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;For blog integrity, I should register that &lt;a href="http://en.wiktionary.org/wiki/IMHO" target="_blank"&gt;IMHO&lt;/a&gt;, there are some aspects of Schoolbase which alas, impress me less (primarily concerning &lt;a href="http://en.wikipedia.org/wiki/User_experience" target="_blank"&gt;UX&lt;/a&gt; / &lt;a href="http://en.wikipedia.org/wiki/User_interface" target="_blank"&gt;UI&lt;/a&gt;) – this should however, not reduce any of the aforementioned compliments; the dream is that Furlong will someday employ a team of experienced professional UX designers - you could then have one exceptional product, backed by one exceptional company!&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;h2&gt;So, AD groups from Schoolbase?&lt;/h2&gt; &lt;p&gt;Like most enterprise environments, we use &lt;a href="http://en.wikipedia.org/wiki/Active_Directory" target="_blank"&gt;Active Directory&lt;/a&gt; groups extensively for managing security permissions on resources &lt;em&gt;(printers / folder etc).&lt;/em&gt;&lt;/p&gt; &lt;p&gt;To manually create these groups in AD, when they &lt;em&gt;already&lt;/em&gt; exist in Schoolbase, does feel very inefficient; an ideal candidate for the &lt;a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself" target="_blank"&gt;DRY&lt;/a&gt; &lt;em&gt;(do not repeat)&lt;/em&gt; principle?&amp;nbsp; Agreed it’s &lt;em&gt;not&lt;/em&gt; specifically a software concern, but it is &lt;em&gt;still&lt;/em&gt; a repetition process – and always &lt;em&gt;potentially &lt;/em&gt;dangerous!&lt;/p&gt; &lt;p&gt;&lt;a href="https://normansolutions.co.uk/posts/files/b9cc4743-d4d1-489e-b2d4-df224189ffa0.jpg"&gt;&lt;img title="Dry" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="Dry" src="https://normansolutions.co.uk/posts/files/c721eca0-3178-4e10-af09-fa363455d51c.jpg" width="244" height="244"&gt;&lt;/a&gt;&lt;/p&gt; &lt;h6&gt;&lt;em&gt;(picture credit: &lt;/em&gt;&lt;a title="http://deviq.com/most-popular-principles/don-t-repeat-yourself" href="http://deviq.com/most-popular-principles/don-t-repeat-yourself" target="_blank"&gt;&lt;em&gt;http://deviq.com/most-popular-principles/don-t-repeat-yourself&lt;/em&gt;&lt;/a&gt;&lt;em&gt;)&lt;/em&gt;&lt;/h6&gt; &lt;p&gt;I enjoy writing small utilities that serve specific purposes - I tend to do this in &lt;a href="http://en.wikipedia.org/wiki/C_Sharp_(programming_language)" target="_blank"&gt;C#&lt;/a&gt; nowadays.&lt;/p&gt; &lt;p&gt;One such utility, is the ability to enumerate through group information held in Schoolbase, creating and populating Active Directory groups appropriately.&amp;nbsp; This maintains consistent synchronisation between the two systems – ensuring Schoolbase remains the prime point of entry &lt;em&gt;(the &lt;a href="http://www.oracle.com/index.html" target="_blank"&gt;Oracle&lt;/a&gt;, so to speak – Geek joke - pun intended!)&lt;/em&gt; thus reducing the chance of users being granted &lt;u&gt;incorrect&lt;/u&gt; AD permissions to resources.&amp;nbsp; &lt;/p&gt; &lt;p&gt;We previously managed this with an array of &lt;a href="http://en.wikipedia.org/wiki/VBScript" target="_blank"&gt;VBScripts&lt;/a&gt; – the C# solution is much more efficient!&lt;/p&gt; &lt;p&gt; &lt;hr&gt;  &lt;h2&gt;The solution!&lt;/h2&gt; &lt;p&gt;Luckily, we are able use an &lt;em&gt;existing&lt;/em&gt; Schoolbase &lt;a href="http://en.wikipedia.org/wiki/View_(SQL)" target="_blank"&gt;SQL View&lt;/a&gt; to gather all appropriate group information from the Schoolbase database – this view is called “&lt;strong&gt;GroupRep&lt;/strong&gt;”.&lt;/p&gt; &lt;p&gt;We connect this sql view to a &lt;a href="http://msdn.microsoft.com/en-us/library/0wc2kk78(v=vs.90).aspx" target="_blank"&gt;C# Console Application&lt;/a&gt;.&amp;nbsp; I recommend a console application, primarily because it can be triggered from a &lt;a href="http://en.wikipedia.org/wiki/Batch_file" target="_blank"&gt;batch file&lt;/a&gt; running in &lt;a href="http://en.wikipedia.org/wiki/Windows_Task_Scheduler" target="_blank"&gt;task scheduler&lt;/a&gt; etc.&lt;/p&gt; &lt;p&gt;The workflow of this program is detailed below, followed by the actual code itself.&lt;/p&gt; &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;&lt;strong&gt;If viewing code is not your thing&lt;/strong&gt;, please feel free to &lt;a href="#jumpToStandAlone"&gt;jump straight to the section below the code&lt;/a&gt;, which contains a link to the compiled standalone executable, a database connection configuration file and an example batch file for triggering the whole thing!&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;h2&gt;The workflow&lt;/h2&gt; &lt;ul&gt; &lt;li&gt;We use &lt;a href="http://msdn.microsoft.com/en-us/library/bb425822.aspx" target="_blank"&gt;Linq to SQL&lt;/a&gt; to connect to the “GroupRep” view, passing in query filters - &lt;em&gt;from the batch file&lt;/em&gt; - in order to &lt;em&gt;only&lt;/em&gt; select those groups matching specific subject name(s) etc.  &lt;li&gt;We then enumerate through the data result, where necessary, &lt;em&gt;removing&lt;/em&gt; existing members from any Schoolbase named AD group, in the specific OU – this will &lt;strong&gt;&lt;u&gt;only&lt;/u&gt;&lt;/strong&gt; remove group membership from these groups in &lt;u&gt;this&lt;/u&gt; OU – it will not touch any other AD groups.  &lt;li&gt;We then use this same enumeration process to create &lt;u&gt;new&lt;/u&gt; AD Groups based on the Schoolbase group name &lt;em&gt;(where they do not exist already).&lt;/em&gt;  &lt;li&gt;Finally we populate / re-populate these Schoolbase AD groups, with appropriate students - based on the Schoolbase student &lt;strong&gt;ADS Username&lt;/strong&gt; field.&lt;/li&gt;&lt;/ul&gt; &lt;hr&gt;  &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;It’s worth noting that there are numerous optimisations within the code, designed to prevent repetitive and unnecessary tasks.&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;&lt;script gitsrc="https://gist.github.com/normansolutions/8541244.js"&gt;&lt;/script&gt;&lt;noscript&gt;&lt;a href="https://gist.github.com/normansolutions/8541244" target="_blank"&gt;Click for code snippet&lt;/a&gt;&lt;/noscript&gt;&lt;/p&gt; &lt;div id="jumpToStandAlone"&gt;&lt;/div&gt; &lt;hr&gt;  &lt;h4&gt;&lt;a href="https://github.com/normansolutions/CreateADGroupsFromSchoolbase/tree/master/StandAloneProgram" target="_blank"&gt;Click here to grab the standalone, ready made tool &amp;amp; appropriate files.&lt;/a&gt;&lt;/h4&gt; &lt;hr&gt;  &lt;h2&gt;Using the tool&lt;/h2&gt; &lt;div&gt;There are three files needed to execute the process:&lt;/div&gt; &lt;div&gt;&amp;nbsp;&lt;/div&gt; &lt;ul&gt; &lt;li&gt;The main executable program &lt;em&gt;(obviously)!&lt;/em&gt;  &lt;li&gt;A SQL database connection string config file &lt;em&gt;(this is literally the details of your SQL server connection). &lt;/em&gt; &lt;li&gt;A batch file containing the appropriate “parameters” &lt;em&gt;(this includes your AD LDAP connection information and query filter information).&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt; &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;Clearly the tool will need to be run under a user account, that has full AD permissions.&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;hr&gt;  &lt;p&gt;&lt;a href="https://normansolutions.co.uk/posts/files/249a56f0-5c0c-45a2-ae72-c6d286d8c70c.jpg"&gt;&lt;img title="Dos" style="display: inline" alt="Dos" src="https://normansolutions.co.uk/posts/files/5979ca16-40c1-4441-8970-da233c7d1715.jpg" width="240" height="238"&gt;&lt;/a&gt;&lt;/p&gt; &lt;h2&gt;Batch file explanation&lt;/h2&gt; &lt;p&gt;The real key to using this process, is understanding the parameters / switches of the batch file.&lt;/p&gt; &lt;p&gt;The batch file is fundamentally broken into 5 arguments (parameters / switches) as explained below:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;The first parameter is where you enter your LDAP connection:&lt;em&gt; e.g. "DC=St-Stephens, DC=Local".&lt;/em&gt;  &lt;li&gt;The second parameter is where you enter the Organisational Unit (OU) of where you are going to create your groups: &lt;em&gt;e.g. "OU=SBGroups".&lt;/em&gt;  &lt;li&gt;The third parameter is where your AD students are located: e&lt;em&gt;.g. "OU=Students, OU=St Stephens Users".&lt;/em&gt;  &lt;li&gt;The forth parameter is where you can filter down, to those subjects containing a name (or names) that you wish to &lt;strong&gt;include&lt;/strong&gt; in your selection; you can create multiple selections by separating each word with a “|” &lt;em&gt;(pipe)&lt;/em&gt; symbol: &lt;em&gt;e.g. "Art|Photo".&lt;/em&gt;  &lt;li&gt;The fifth parameter is where you can filter out those subjects containing a name (or names) that you wish to &lt;strong&gt;exclude&lt;/strong&gt; from your selection; again, you can create multiple selections by separating each word with a “|” &lt;em&gt;(pipe)&lt;/em&gt; symbol: &lt;em&gt;e.g. "UCAS|History".&lt;/em&gt;&lt;/li&gt;&lt;/ol&gt; &lt;hr&gt;  &lt;h2&gt;Example&lt;/h2&gt; &lt;p&gt;Below is an example batch file, that when run &lt;em&gt;(either manually or on a task schedule) &lt;/em&gt;will select only those groups, where the subject name is like &lt;strong&gt;Art&lt;/strong&gt; or &lt;strong&gt;Photo&lt;/strong&gt; but &lt;u&gt;doesn’t&lt;/u&gt; contain the word &lt;strong&gt;UCAS&lt;/strong&gt;. &lt;/p&gt; &lt;p&gt;It would create new AD Groups within an &lt;em&gt;existing&lt;/em&gt; OU called “SBGroups” on an Active Directory domain titled “St-Stephens.Local” - populating these groups with students found in an OU called “Students” under a parent OU “St Stephens Users”.&lt;/p&gt; &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;Trust me – it’s a lot easier than it reads!&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;p&gt;&lt;script gitsrc="https://gist.github.com/normansolutions/8543419.js"&gt;&lt;/script&gt;&lt;noscript&gt;&lt;a href="https://gist.github.com/normansolutions/8543419" target="_blank"&gt;Click for code snippet&lt;/a&gt;&lt;/noscript&gt;&lt;/p&gt; &lt;p&gt; &lt;hr&gt;  &lt;h2&gt;Conclusion&lt;/h2&gt; &lt;p&gt;Clearly, this is just one solution to a problem, and may not fit every situation.&amp;nbsp; But under the banner of “openness and sharing” you may just find something useful in this post.&lt;/p&gt; &lt;blockquote&gt; &lt;p&gt;&lt;em&gt;It’s worth noting, that we have also experienced quite a nice side benefit from using this system, in that students and staff are much more likely to inform you of teaching group changes, when their access to network resources are involved!&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt; &lt;hr&gt;  &lt;p&gt;The entire project is available on my &lt;a href="https://github.com/normansolutions/CreateADGroupsFromSchoolbase" target="_blank"&gt;GitHub account here&lt;/a&gt;; please fee free to download it, fork it, adjust it or completely ignore it!&lt;/p&gt; &lt;p&gt;You may also choose to compose a different query, to create different group types?&lt;/p&gt; &lt;p&gt;&lt;em&gt;It also goes without saying, that you use any of this code, entirely at your own risk &lt;img class="wlEmoticon wlEmoticon-smile" style="border-top-style: none; border-bottom-style: none; border-right-style: none; border-left-style: none" alt="Smile" src="https://normansolutions.co.uk/posts/files/9db7f07e-deb1-4994-8457-1a72d14f2c4c.png"&gt;&lt;/em&gt;&lt;/p&gt;</content>
  <ispublished>true</ispublished>
  <categories>
    <category>Schoolbase</category>
    <category>MIS</category>
    <category>C#</category>
    <category>SysAdmin</category>
    <category>DevOps</category>
  </categories>
  <comments></comments>
</post>